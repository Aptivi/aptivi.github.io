@using aptivi.github.io.Data

<div class="general-container">
	<div class="carousel-container">
		<div id="@Id" class="carousel slide mb-6" data-bs-ride="carousel" data-carousel-id="@Id" style="padding: 0 0 2em">
			<div class="carousel-inner jumbotron" style="border-radius: 12px; overflow: hidden;">
				@if (Slides is not null)
				{
					int idx = 0;
					@foreach (var slide in Slides)
					{
						string current = idx == 0 ? "active" : "";
						<div class="carousel-item @current" data-caption-index="@idx">
							<img class="d-block w-100 bg-gradient" src="@slide.Picture" alt="Slide @(idx + 1)" style="max-width: 100%; height: auto;">
						</div>
						idx++;
					}
				}
			</div>
		</div>
		<BrandedBorder>
			<div class="d-flex flex-column flex-md-row w-100 gap-2 gap-md-3 align-items-center">
				<div class="carousel-captions-container flex-grow-1 p-2 p-md-5 w-100 order-1">
					@if (Slides is not null)
					{
						int idx = 0;
						@foreach (var slide in Slides)
						{
							string current = idx == 0 ? "active" : "";
							<div class="caption-content text-center @current" data-caption-index="@idx">
								<h1 class="fs-3 fs-md-1">@slide.Title</h1>
								<p class="mb-0">@slide.Description</p>
							</div>
							idx++;
						}
					}
				</div>
				<div class="d-flex d-md-none flex-row justify-content-between w-100 gap-2 order-2 px-2">
					<button class="btn btn-primary px-3 flex-grow-1" type="button" data-bs-target="#@Id" data-bs-slide="prev">
						<span class="carousel-control-prev-icon" aria-hidden="true"></span>
						<span class="visually-hidden">Previous</span>
					</button>

					<button class="btn btn-primary px-3 flex-grow-1" type="button" data-bs-target="#@Id" data-bs-slide="next">
						<span class="carousel-control-next-icon" aria-hidden="true"></span>
						<span class="visually-hidden">Next</span>
					</button>
				</div>
				<button class="btn btn-primary px-4 flex-shrink-0 order-md-0 d-none d-md-block" type="button" data-bs-target="#@Id" data-bs-slide="prev">
					<span class="carousel-control-prev-icon" aria-hidden="true"></span>
					<span class="visually-hidden">Previous</span>
				</button>
				<button class="btn btn-primary px-4 flex-shrink-0 order-md-2 d-none d-md-block" type="button" data-bs-target="#@Id" data-bs-slide="next">
					<span class="carousel-control-next-icon" aria-hidden="true"></span>
					<span class="visually-hidden">Next</span>
				</button>
			</div>
		</BrandedBorder>
		<script>
			(function() {
				const container = document.currentScript.closest('.carousel-container');
				if (!container) return;
				const carouselElement = container.querySelector('.carousel.slide');
				if (!carouselElement) return;
				const carouselId = carouselElement.getAttribute('data-carousel-id');
				if (!carouselId) return;
				function updateCaption() {
					const active = carouselElement.querySelector('.carousel-item.active');
					if (!active) return;
					const captionIdx = active.getAttribute('data-caption-index');
					container.querySelectorAll('.caption-content').forEach(caption => {
						caption.classList.remove('active');
					});
					const activeCaption = container.querySelector('.caption-content[data-caption-index="' + captionIdx + '"]');
					if (activeCaption) {
						activeCaption.classList.add('active');
					}
				}
				carouselElement.addEventListener('slid.bs.carousel', updateCaption);
				container.addEventListener('slid.bs.carousel', updateCaption);
				updateCaption();
			})();
		</script>
	</div>
</div>

@code
{
	[Parameter]
	public string Id { get; set; } = "DefaultCarousel";
	[Parameter]
	public SlideDescriptor[] Slides { get; set; } = [];
}
